<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SANDGATE ãƒ•ãƒƒã‚¯ç”Ÿæˆå™¨ Pro+++ï¼ˆGPTæ¥ç¶šå¯¾å¿œï¼‰</title>
<meta name="description" content="SANDGATEå‘ã‘ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ãƒ•ãƒƒã‚¯ç”Ÿæˆå™¨ã€‚å›ºå®šæ‚©ã¿ã‚»ãƒ¬ã‚¯ãƒˆãƒ»å›ºå®šã‚¿ã‚°ç·¨é›†ãƒ»è¿½åŠ ã‚¿ã‚°è¨˜æ†¶ãƒ»ãƒ•ã‚©ãƒ­ãƒ¼CTAã€‚GPTæ¥ç¶šã§æ¯å›é•ã†æ–‡ç« ã‚’ç”Ÿæˆã€‚" />
<style>
  :root{--bg:#0f1115;--panel:#171a21;--ink:#e8ecf1;--muted:#a6b0c0;--accent:#59d;--accent2:#9d5;--ok:#3bb273;--danger:#e25;--border:#242936;--chip:#242a36;--radius:12px;--radius-sm:8px;--shadow:0 10px 30px rgba(0,0,0,.35);--mono:ui-monospace,Menlo,Consolas,monospace}
  *{box-sizing:border-box}html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,-apple-system,"Noto Sans JP",sans-serif;background:
    radial-gradient(1200px 800px at 80% -20%, rgba(89,157,221,.12), transparent 60%),
    radial-gradient(800px 600px at -10% 110%, rgba(157,221,85,.12), transparent 60%),
    var(--bg);color:var(--ink);line-height:1.6}
  header{position:sticky;top:0;z-index:10;backdrop-filter:blur(6px);background:linear-gradient(180deg, rgba(15,17,21,.9), rgba(15,17,21,.65));border-bottom:1px solid var(--border)}
  .wrap{max-width:1120px;margin:0 auto;padding:20px}
  .title{display:flex;align-items:center;gap:12px}
  .logo{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:inset 0 0 0 2px rgba(255,255,255,.12)}
  h1{font-size:22px;margin:0}
  main{padding:32px 0 60px}
  .grid{display:grid;gap:18px;grid-template-columns:1.2fr .8fr}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
  .panel-inner{padding:18px}
  .panel h2{margin:0 0 8px;font-size:16px;color:var(--muted);font-weight:600;letter-spacing:.02em}
  .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  .row-3{grid-template-columns:1fr 1fr 1fr}
  .row + .row, .row + .row-3, .row-3 + .row{margin-top:12px}
  @media (max-width:720px){.row,.row-3{grid-template-columns:1fr}}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
  input[type="text"],input[type="url"],textarea,select{width:100%;background:#0d0f13;color:var(--ink);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 14px;outline:none;font-size:14px;transition:border .2s ease, box-shadow .2s ease}
  textarea{min-height:72px;resize:vertical}
  input::placeholder,textarea::placeholder{color:#61708a}
  input:focus,textarea:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 4px rgba(89,157,221,.15)}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;background:var(--chip);border:1px solid var(--border);font-size:12px;color:var(--muted);cursor:pointer;user-select:none}
  .chip.active{outline:2px solid rgba(89,157,221,.4);color:var(--ink)}
  .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
  .btn{border:1px solid var(--border);background:linear-gradient(180deg,#1a1f29,#131720);color:var(--ink);padding:12px 16px;border-radius:10px;cursor:pointer;font-weight:600;transition:transform .06s ease, box-shadow .2s ease, border-color .2s ease}
  .btn:hover{border-color:var(--accent);box-shadow:0 8px 18px rgba(0,0,0,.35)}
  .btn:active{transform:translateY(1px)}
  .btn.primary{background:linear-gradient(180deg,var(--accent),#2a65a8);border-color:rgba(255,255,255,.15)}
  .btn.ghost{background:transparent}
  .btn.ok{background:linear-gradient(180deg,var(--ok),#1b6c4a)}
  .btn.danger{background:linear-gradient(180deg,var(--danger),#a4163a)}
  .note{color:var(--muted);font-size:12px;margin-top:8px}
  .result-grid{display:grid;gap:14px;grid-template-columns:1fr 1fr}
  @media (max-width:980px){.result-grid{grid-template-columns:1fr}}
  .card{border:1px solid var(--border);border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));padding:16px;box-shadow:var(--shadow)}
  .card .meta{font-size:12px;color:var(--muted);display:flex;gap:10px;justify-content:space-between;align-items:center;flex-wrap:wrap}
  .card p{margin:10px 0 0;white-space:pre-wrap}
  .badge{display:inline-block;font-size:11px;color:#111;background:var(--accent2);padding:3px 8px;border-radius:999px;font-weight:700;letter-spacing:.02em}
  .toolbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}
  .toolbar .left{display:flex;align-items:center;gap:10px}
  .toolbar .right{display:flex;align-items:center;gap:8px}
  .kbd{font-family:var(--mono);font-size:12px;color:var(--muted);border:1px solid var(--border);background:var(--chip);padding:2px 6px;border-radius:6px}
  .copy{display:inline-flex;align-items:center;gap:8px;font-size:12px;padding:8px 10px;border-radius:8px;border:1px dashed var(--border);cursor:pointer}
  footer{padding:24px 20px;color:var(--muted);border-top:1px solid var(--border)}
  .small{font-size:12px;color:var(--muted)}
  .inline{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .toggle{display:flex;gap:8px;align-items:center}
  .thumb{font-family:var(--mono);font-size:12px;background:#10141c;border:1px dashed var(--border);padding:6px 8px;border-radius:8px;display:inline-flex;gap:8px;align-items:center}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:var(--chip);font-size:11px;color:var(--muted)}
</style>
</head>
<body>
  <header>
    <div class="wrap title">
      <div class="logo" aria-hidden="true"></div>
      <h1>SANDGATE ãƒ•ãƒƒã‚¯ç”Ÿæˆå™¨ <span class="small">Pro+++ / GPT</span></h1>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <section class="panel">
        <div class="panel-inner">
          <h2>å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </h2>

          <div class="row">
            <div>
              <label>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ</label>
              <select id="target">
                <option>å¤§å­¦ç”Ÿ</option><option selected>ç¤¾ä¼šäºº</option><option>å–¶æ¥­è·</option><option>ãƒ‘ãƒ‘ä¸–ä»£</option><option>å°±æ´»ãƒ»é¢æ¥</option><option>ãƒ‡ãƒ¼ãƒˆå‰</option><option>ãƒ“ã‚¸ãƒã‚¹ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«</option>
              </select>
            </div>
            <div>
              <label>ä¸»ãªæ‚©ã¿ / åˆ¶ç´„ï¼ˆå›ºå®šãƒªã‚¹ãƒˆï¼‰</label>
              <select id="pain">
                <option>ã‚»ãƒƒãƒˆãŒæ±ºã¾ã‚‰ãªã„</option>
                <option>ä¼¼åˆã†é«ªå‹ãŒã‚ã‹ã‚‰ãªã„</option>
                <option>ã†ã­ã‚Šãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ </option>
                <option>æœã®æ™‚çŸ­</option>
                <option>æ ¡å‰‡ãƒ»è·å ´ã®è¦å®š</option>
                <option selected>è–„æ¯›ãƒ»ç”Ÿãˆéš›</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label>æ„Ÿæƒ…ãƒˆãƒ¼ãƒ³</label>
              <select id="tone">
                <option>æŒ‘ç™º</option><option selected>å…±æ„Ÿ</option><option>æ¨©å¨</option><option>ç¦æ­¢</option><option>æ„Ÿå‹•</option>
              </select>
            </div>
            <div>
              <label>CTAï¼ˆè¡Œå‹•ï¼‰</label>
              <select id="cta">
                <option selected>äºˆç´„ã™ã‚‹</option>
                <option>ä¿å­˜ã™ã‚‹</option>
                <option>DMã™ã‚‹</option>
                <option>ã„ã„ã­ã™ã‚‹</option>
                <option>ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹</option>
                <option>ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹</option>
              </select>
            </div>
          </div>

          <div class="row-3 row">
            <div>
              <label>åœ°åŸŸãƒ»åº—åï¼ˆåˆæœŸå€¤ï¼‰</label>
              <input id="brand" type="text" value="ç¦äº•å¸‚ãƒ»SANDGATE ã‚µãƒ³ãƒ‰ã‚²ãƒ¼ãƒˆ" />
            </div>
            <div>
              <label>äºˆç´„URLï¼ˆä»»æ„ï¼‰</label>
              <input id="bookUrl" type="url" placeholder="https://sand-gate.jp/reserve" />
              <div class="inline">
                <label class="toggle"><input id="autoUrl" type="checkbox" checked /> CTAã«äºˆç´„URLã‚’è‡ªå‹•ä»˜ä¸</label>
              </div>
            </div>
            <div>
              <label>å‡ºåŠ›é•·ã•ï¼ˆä¸Šé™ï¼‰</label>
              <select id="length">
                <option value="0" selected>ãƒ•ãƒªãƒ¼ï¼ˆåˆ¶é™ãªã—ï¼‰</option>
                <option value="30">ç´„30æ–‡å­—</option>
                <option value="60">ç´„60æ–‡å­—</option>
                <option value="90">ç´„90æ–‡å­—</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label>å›ºå®šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆç·¨é›†å¯ãƒ»ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
              <input id="fixedTags" type="text" value="#ç¦äº•ãƒ¡ãƒ³ã‚ºç¾å®¹å®¤, #SANDGATE, #ã‚µãƒ³ãƒ‰ã‚²ãƒ¼ãƒˆ" />
              <div class="note">â€» å…ˆé ­ã« # ãŒãªãã¦ã‚‚è‡ªå‹•ã§ä»˜ä¸ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</div>
            </div>
            <div>
              <label>è¿½åŠ ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆè‡ªå‹•è¨˜æ†¶ãƒ»ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
              <input id="extraTags" type="text" placeholder="ä¾‹ï¼š#ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«, #ã‚¹ã‚­ãƒ³ãƒ•ã‚§ãƒ¼ãƒ‰" />
              <div class="inline">
                <label class="toggle"><input id="autoTag" type="checkbox" checked /> è‡ªå‹•ã‚¿ã‚°ï¼ˆåœ°åŸŸ/ãƒ•ã‚§ãƒ¼ãƒ‰/æ±ç”¨ï¼‰ã‚’ä»˜ä¸</label>
              </div>
            </div>
          </div>

          <div class="row">
            <div>
              <label>ç¸¦é•·ã‚µãƒ ãƒæ–‡è¨€ï¼ˆé•·ã•ï¼‰</label>
              <select id="thumbLen">
                <option value="8">æ¥µçŸ­ï¼ˆã€œ8å­—ï¼‰</option>
                <option value="12" selected>çŸ­ã‚ï¼ˆã€œ12å­—ï¼‰</option>
                <option value="16">ã‚„ã‚„é•·ã‚ï¼ˆã€œ16å­—ï¼‰</option>
              </select>
            </div>
            <div>
              <label>è¿½åŠ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆæœ¬æ–‡ã«è‡ªç„¶æŒ¿å…¥ï¼ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
              <input id="keywords" type="text" value="æ¸…æ½”æ„Ÿ, ç¬¬ä¸€å°è±¡, ãƒ•ã‚§ãƒ¼ãƒ‰" />
            </div>
          </div>

          <div class="row">
            <div>
              <label class="toggle"><input id="useGpt" type="checkbox" /> GPTã§ç”Ÿæˆã™ã‚‹</label>
            </div>
            <div>
              <label>GPT APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆVercelï¼‰</label>
              <input id="gptEndpoint" type="url" placeholder="https://your-app.vercel.app/api/generate" />
              <div class="note">ç¤¾å†…å‘ã‘ï¼šã“ã®URLã¯ä¸€åº¦å…¥åŠ›ã™ã‚Œã°ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</div>
            </div>
          </div>

          <div class="chips" id="patterns"></div>

          <div class="btns">
            <button class="btn primary" id="gen">ç”Ÿæˆã™ã‚‹</button>
            <button class="btn ghost" id="shuffle">ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
            <button class="btn danger" id="clear">ã‚¯ãƒªã‚¢</button>
          </div>
          <div class="note">ã‚«ãƒ¼ãƒ‰ã®ã€Œã‚³ãƒ”ãƒ¼ã€ã§æœ¬æ–‡ã€ã‚µãƒ ãƒè¡Œã¯å€‹åˆ¥ã«ã‚³ãƒ”ãƒ¼ã§ãã¾ã™ã€‚</div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-inner">
          <div class="toolbar">
            <div class="left"><span class="badge">RESULT</span><span class="small">ã‚¹ãƒ¯ã‚¤ãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ï¼‹ã‚µãƒ ãƒæ–‡è¨€</span></div>
            <div class="right"><button class="btn ok" id="copyAll">å…¨éƒ¨ã‚³ãƒ”ãƒ¼</button></div>
          </div>
          <div id="results" class="result-grid" aria-live="polite"></div>
        </div>
      </section>
    </div>
  </main>

  <footer class="wrap small">Â© 2025 SANDGATE Swipe File Generatorï½œå›ºå®šæ‚©ã¿ã‚»ãƒ¬ã‚¯ãƒˆãƒ»ç·¨é›†å¯èƒ½ã‚¿ã‚°ãƒ»ãƒ•ã‚©ãƒ­ãƒ¼CTAãƒ»GPTæ¥ç¶š</footer>

<script>
(function(){
  const $ = (q)=>document.querySelector(q);
  const results = $('#results');
  const target=$('#target'), tone=$('#tone'), cta=$('#cta');
  const brand=$('#brand'), keywords=$('#keywords'), bookUrl=$('#bookUrl'), autoUrl=$('#autoUrl'), lengthSel=$('#length');
  const thumbLenSel=$('#thumbLen'), autoTag=$('#autoTag');
  const fixedTagsInput=$('#fixedTags'), extraTags=$('#extraTags');
  const painSel=$('#pain');
  const btnGen=$('#gen'), btnClear=$('#clear'), btnShuffle=$('#shuffle'), btnCopyAll=$('#copyAll');
  const chipsWrap=$('#patterns');
  const useGpt=$('#useGpt'), gptEndpoint=$('#gptEndpoint');

  const LS = {
    fixedTags: 'sg_fixed_tags',
    extraTags: 'sg_extra_tags',
    brand: 'sg_brand',
    bookUrl: 'sg_bookurl',
    gptEndpoint: 'sg_gpt_endpoint',
    useGpt: 'sg_use_gpt'
  };

  const rand = (arr)=>arr[Math.floor(Math.random()*arr.length)];
  const toArray = (s)=> (s||"").split(",").map(t=>t.trim()).filter(Boolean);
  const ensureHash = (t)=> t.startsWith("#") ? t : ("#"+t.replace(/^#+/,""));

  function loadPersisted(){
    const fixed = localStorage.getItem(LS.fixedTags);
    if(fixed){ fixedTagsInput.value = fixed; }
    const ext = localStorage.getItem(LS.extraTags);
    if(ext){ extraTags.value = ext; }
    const b = localStorage.getItem(LS.brand); if(b) brand.value = b;
    const u = localStorage.getItem(LS.bookUrl); if(u) bookUrl.value = u;
    const ep = localStorage.getItem(LS.gptEndpoint); if(ep) gptEndpoint.value = ep;
    const ug = localStorage.getItem(LS.useGpt); if(ug){ useGpt.checked = ug === '1'; }
  }

  fixedTagsInput.addEventListener("change", ()=> localStorage.setItem(LS.fixedTags, fixedTagsInput.value));
  extraTags.addEventListener("change", ()=> localStorage.setItem(LS.extraTags, extraTags.value));
  brand.addEventListener("change", ()=> localStorage.setItem(LS.brand, brand.value));
  bookUrl.addEventListener("change", ()=> localStorage.setItem(LS.bookUrl, bookUrl.value));
  gptEndpoint.addEventListener("change", ()=> localStorage.setItem(LS.gptEndpoint, gptEndpoint.value));
  useGpt.addEventListener("change", ()=> localStorage.setItem(LS.useGpt, useGpt.checked ? '1' : '0'));

  const CTA = {
    "äºˆç´„ã™ã‚‹":["ä»Šã™ãäºˆç´„","ã‚«ãƒƒãƒˆã¯ã“ã“ã‹ã‚‰","å¸­ãŒåŸ‹ã¾ã‚‹å‰ã«äºˆç´„"],
    "ä¿å­˜ã™ã‚‹":["ã‚ã¨ã§è¦‹è¿”ã›ã‚‹ã‚ˆã†ä¿å­˜","ä¿å­˜ã—ã¦æ¬¡å›ã‚ªãƒ¼ãƒ€ãƒ¼","ä¿å­˜â†’æ‹…å½“ã«è¦‹ã›ã¦"],
    "DMã™ã‚‹":["DMã§ç›¸è«‡","åŒ¿åã§ç›¸è«‡OK","å¸Œæœ›ã‚’DMã§é€ã£ã¦"],
    "ã„ã„ã­ã™ã‚‹":["ã„ã„ã­ã§å¿œæ´","å‚è€ƒã«ãªã£ãŸã‚‰ğŸ‘","ç¶šç·¨å¸Œæœ›ã¯ã„ã„ã­"],
    "ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹":["æ‚©ã¿ã‚’ã‚³ãƒ¡ãƒ³ãƒˆ","ã©ã£ã¡æ´¾ã‹ã‚³ãƒ¡ãƒ³ãƒˆã§","è³ªå•ã¯ã‚³ãƒ¡ãƒ³ãƒˆã§"],
    "ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹":["ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ç¶šç·¨ã‚’è¦‹ã‚‹","æœ€æ–°æŠ•ç¨¿ã‚’è¦‹é€ƒã•ãªã„ã‚ˆã†ãƒ•ã‚©ãƒ­ãƒ¼","ãƒ•ã‚§ãƒ¼ãƒ‰å¥½ãã¯ãƒ•ã‚©ãƒ­ãƒ¼"]
  };

  const VISUAL = ["ï¼ˆæ•°ç§’ã®é™æ­¢ï¼‰","ã€å…ˆã«è¬ã‚Šã¾ã™ã€‘","ï¼¼å†™çœŸã¯åŒä¸€äººç‰©ï¼","â–¼ ã“ã“ã ã‘ã®è©±","â€» æ³¨æ„ï¼šè¦‹ãŸã‚‰æˆ»ã‚Œã¾ã›ã‚“"];
  const LOCAL_TAGS = ["#ç¦äº•","#ç¦äº•å¸‚","#ç¦äº•å¸‚ç¾å®¹å®¤","#ç¦äº•ç†å®¹å®¤"];
  const FADE_TAGS  = ["#ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«","#ãƒ•ã‚§ãƒ¼ãƒ‰ã‚«ãƒƒãƒˆ","#ã‚¹ã‚­ãƒ³ãƒ•ã‚§ãƒ¼ãƒ‰","#ãƒŸãƒƒãƒ‰ãƒ•ã‚§ãƒ¼ãƒ‰","#ãƒ­ãƒ¼ãƒ•ã‚§ãƒ¼ãƒ‰","#ãƒã‚¤ãƒ•ã‚§ãƒ¼ãƒ‰","#ãƒãƒ¼ãƒãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«","#ãƒ¡ãƒ³ã‚ºã‚«ãƒƒãƒˆ","#ãƒ¡ãƒ³ã‚ºãƒ˜ã‚¢"];
  const GENERAL_TAGS=["#æ¸…æ½”æ„Ÿ","#ç¬¬ä¸€å°è±¡","#å°±æ´»ãƒ˜ã‚¢","#ãƒ“ã‚¸ãƒã‚¹ãƒ˜ã‚¢","#å¤§äººç”·å­","#ãƒ¡ãƒ³ã‚ºã‚»ãƒƒãƒˆ"];

  const PATTERNS = [
    { id:"å…±æ„ŸÃ—é€†è»¢",  text:({t,p,b,k})=>`ã€Œç¾å®¹å®¤ã§â€œã„ã¤ã‚‚é€šã‚Šã§â€ã£ã¦è¨€ã£ãŸã‚‰ã€ã„ã¤ã‚‚é€šã‚Šã˜ã‚ƒãªã‹ã£ãŸè©±ã€‚ã€\n${t}ã®${p}ã«åˆºã•ã‚‹ã€${b}ã®å®Ÿä¾‹ã§è§£èª¬ã€‚${k}` },
    { id:"ç§˜å¯†æš´éœ²",    text:({t,p,b,k})=>`å®Ÿã¯ã€Œ${t}ãŒãƒ¢ãƒ†ã‚‹é«ªå‹ã€ã«ã¯3ã¤ã®å…±é€šç‚¹ãŒã‚ã‚‹ã€‚\næœ€å¾Œã«${b?b+'ã§ã®':""}ãƒ™ã‚¹ãƒˆã‚ªãƒ¼ãƒ€ãƒ¼ä¾‹ã‚’å…¬é–‹ã€‚${k}` },
    { id:"å¤±æ•—â†’è§£æ±º",  text:({t,p,b,k})=>`æ˜”ã®è‡ªåˆ†ã¸ï¼š${p}ã®åŸå› ã€ã“ã‚Œã§ã—ãŸã€‚\nä»Šæ—¥ã‹ã‚‰3ã¤ã ã‘çœŸä¼¼ã—ã¦ã€‚${b?b+'ã§ã‚‚å³ã§ãã‚‹ã€‚':""}${k?'\n'+k:''}` },
    { id:"ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰",  text:({t,p,b,k})=>`ã“ã®é«ªå‹ã ã‘ã¯é¸ã°ãªã„ã§ã€‚è¦‹ãŸç›®ãŒä¸€æ°—ã«è€ã‘ã‚‹ã€‚\n${t}ã®${p}ã‚¿ã‚¤ãƒ—ã¯è¦æ³¨æ„ã€‚${k}` },
    { id:"æ‰¿èªÃ—å¤‰èº«",  text:({t,p,b,k})=>`ã€Œæ¸…æ½”æ„Ÿãªã„ã€ã£ã¦è¨€ã‚ã‚ŒãŸä¿ºãŒã€2ãƒ¶æœˆã§ã€Œçˆ½ã‚„ã‹ã™ãã€ã¨è¨€ã‚ã‚ŒãŸç†ç”±ã€‚\n${t}ã®${p}ã§ã‚‚å†ç¾å¯ã€‚${k}` },
    { id:"æ—¥å¸¸ã‚®ãƒ£ãƒƒãƒ—",text:({t,p,b,k})=>`è·å ´ã§ã¯æ™®é€šã€ãƒ‡ãƒ¼ãƒˆã§ã¯ã€Œé›°å›²æ°—å¤‰ã‚ã£ãŸã­ã€ã€‚\n${t}å‘ã‘${p}å¯¾ç­–ã®äºŒåˆ€æµãƒ˜ã‚¢ã€‚${k}` },
    { id:"æŒ‘ç™ºÃ—å‘½ä»¤",  text:({t,p,b,k})=>`ã€Œã‚»ãƒƒãƒˆè‹¦æ‰‹ã€ã£ã¦è¨€ã†å‰ã«ã€ã“ã‚Œè¦‹ã¦ã‹ã‚‰è¨€ã£ã¦ã€‚\n${t}ã®${p}ã¯ã“ã®1åˆ†ã§è§£æ±ºã€‚${k}` },
    { id:"æ¯”è¼ƒÃ—é©šã",  text:({t,p,b,k})=>`åŒä¸€äººç‰©ã€é«ªå‹ã ã‘ã§ç¬¬ä¸€å°è±¡ãŒæ¿€å¤‰ã€‚\n${t}ã®${p}å‘ã‘ã«${b?b+'å®Ÿç¸¾ã®':""}ãƒ“ãƒ•ã‚©ãƒ¼ã‚¢ãƒ•ã‚¿ãƒ¼å…¬é–‹ã€‚${k}` },
    { id:"ãƒ‡ãƒ¼ã‚¿Ã—æ¨©å¨",text:({t,p,b,k})=>`ç¬¬ä¸€å°è±¡ã§è¦‹ã‚‰ã‚Œã¦ã‚‹ã®ã¯â—¯â—¯ï¼…ã€Œé«ªã€ã€‚\n${t}ã®${p}ã»ã©å·®ãŒå‡ºã‚‹ã€‚${k}` },
    { id:"æ„Ÿæƒ…Ã—æ²ˆé»™",  text:({t,p,b,k})=>`${VISUAL[Math.floor(Math.random()*VISUAL.length)]}\nåˆ¥ã‚ŒãŸç†ç”±ã€ä»Šãªã‚‰ã‚ã‹ã‚‹ã€‚é«ªã ã£ãŸã€‚\n${t}ã®${p}ã¯ä»Šæ—¥ã‹ã‚‰å¤‰ãˆã‚ˆã†ã€‚${k}` },
  ];

  const TONE = {
    "æŒ‘ç™º": (s)=> s.replace("è¦‹ã¦ã‹ã‚‰è¨€ã£ã¦","é»™ã£ã¦çœŸä¼¼ã—ã¦").replace("è¦æ³¨æ„","ä»Šã™ãã‚„ã‚ã¦"),
    "å…±æ„Ÿ": (s)=> "æ­£ç›´ã«è¨€ã†ã¨ã€" + s.replace("ã“ã‚Œã§ã—ãŸã€‚","ã“ã‚ŒãŒå¤šã‹ã£ãŸã§ã™ã€‚"),
    "æ¨©å¨": (s)=> "ãƒ—ãƒ­ã®çµè«–ï¼š" + s.replace("å…¬é–‹ã€‚","å…¬é–‹ã—ã¾ã™ã€‚").replace("è¦æ³¨æ„ã€‚","æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚"),
    "ç¦æ­¢": (s)=> s.replace("é¸ã°ãªã„ã§","çµ¶å¯¾ã«é¸ã°ãªã„ã§").replace("ã‚„ã‚ã‚ˆã†ã€‚","ã‚„ã‚ã¦ãã ã•ã„ã€‚"),
    "æ„Ÿå‹•": (s)=> s.replace("æ˜”ã®è‡ªåˆ†ã¸ï¼š","ã‚ã®æ—¥ã®è‡ªåˆ†ã¸ã€‚").replace("æ¿€å¤‰ã€‚","åŠ‡çš„ã«å¤‰ã‚ã‚‹ã€‚")
  };

  function parseFixedTags(){
    return (document.querySelector('#fixedTags').value || '')
      .split(',').map(s=>s.trim()).filter(Boolean)
      .map(t=> t.startsWith('#') ? t : '#'+t.replace(/^#+/,'') );
  }
  function injectKeywords(text,kws){
    if(!kws.length) return text;
    const tag = " #" + kws.slice(0,3).map(x=>x.replace(/\s+/g,'')).join(" #");
    const lines = text.split("\n");
    if(lines.length>1) lines[1] = lines[1] + " " + tag; else text += " " + tag;
    return lines.join("\n");
  }
  function attachURL(text){
    const url = bookUrl.value.trim();
    if(!url || !autoUrl.checked) return text;
    const lines = text.split("\n");
    let placed=false;
    for(let i=lines.length-1;i>=0;i--){
      if(/äºˆç´„|DM|ä¿å­˜|ã‚³ãƒ¡ãƒ³ãƒˆ|ã„ã„ã­|ãƒ•ã‚©ãƒ­ãƒ¼/.test(lines[i])){
        lines[i] = lines[i] + " â†’ " + url;
        placed = true; break;
      }
    }
    if(!placed) lines.push("äºˆç´„ã¯ã“ã¡ã‚‰ â†’ " + url);
    return lines.join("\n");
  }
  function pickTags(){
    const FIXED = parseFixedTags();
    const ext = (extraTags?.value || '').split(',').map(s=>s.trim()).filter(Boolean).map(t=> t.startsWith('#') ? t : '#'+t.replace(/^#+/,'') );
    const LOCAL_TAGS = ["#ç¦äº•","#ç¦äº•å¸‚","#ç¦äº•å¸‚ç¾å®¹å®¤","#ç¦äº•ç†å®¹å®¤"];
    const FADE_TAGS  = ["#ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«","#ãƒ•ã‚§ãƒ¼ãƒ‰ã‚«ãƒƒãƒˆ","#ã‚¹ã‚­ãƒ³ãƒ•ã‚§ãƒ¼ãƒ‰","#ãƒŸãƒƒãƒ‰ãƒ•ã‚§ãƒ¼ãƒ‰","#ãƒ­ãƒ¼ãƒ•ã‚§ãƒ¼ãƒ‰","#ãƒã‚¤ãƒ•ã‚§ãƒ¼ãƒ‰","#ãƒãƒ¼ãƒãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«","#ãƒ¡ãƒ³ã‚ºã‚«ãƒƒãƒˆ","#ãƒ¡ãƒ³ã‚ºãƒ˜ã‚¢"];
    const GENERAL_TAGS=["#æ¸…æ½”æ„Ÿ","#ç¬¬ä¸€å°è±¡","#å°±æ´»ãƒ˜ã‚¢","#ãƒ“ã‚¸ãƒã‚¹ãƒ˜ã‚¢","#å¤§äººç”·å­","#ãƒ¡ãƒ³ã‚ºã‚»ãƒƒãƒˆ"];
    const rand = (arr)=>arr[Math.floor(Math.random()*arr.length)];
    const smart = [rand(LOCAL_TAGS), rand(FADE_TAGS), rand(FADE_TAGS), rand(GENERAL_TAGS)].filter(Boolean);
    const uniq = Array.from(new Set([...FIXED, ...smart, ...ext]));
    return uniq.join(" ");
  }
  function attachTags(text){
    if(!autoTag.checked) return text;
    const tags = pickTags();
    return text + "\n" + tags;
  }
  function limitLength(text, limit){
    if(!limit || limit<=0) return text;
    if(text.length <= limit) return text;
    const cut = text.slice(0, limit - 1);
    const lastBreak = Math.max(cut.lastIndexOf("ã€‚"), cut.lastIndexOf("\n"), cut.lastIndexOf("ï¼"), cut.lastIndexOf("ï¼Ÿ"));
    const finalText = (lastBreak>10 ? cut.slice(0,lastBreak) : cut) + "â€¦";
    return finalText;
  }
  function makeThumb(patternId, ctx, maxChars){
    const basePool = [
      "æ¸…æ½”æ„Ÿã€æ­£ç¾©","ãã®é«ªã€æã—ã¦ã‚‹","ç¬¬ä¸€å°è±¡ã¯é«ª","1åˆ†ã§æ¿€å¤‰","ä¼¼åˆã†ã¯ä½œã‚Œã‚‹",
      "æ¸…æ½”æ„Ÿã‚’ã€åˆˆã‚‹","ä»•äº‹å‹ã¦ã‚‹é«ª","å³ãƒ»çˆ½ã‚„ã‹","å¤§äººã®æ­£è§£ãƒ˜ã‚¢","å°±æ´»ã¯å‰é«ªã‹ã‚‰"
    ];
    const fadePool = ["ãƒ•ã‚§ãƒ¼ãƒ‰ã§æ¸…æ½”æ„Ÿ","ã‚¹ã‚­ãƒ³ãƒ•ã‚§ãƒ¼ãƒ‰","æœ€çŸ­ã§å¢æŠœã‘","æ¨ªé¡”ãŒæ­¦å™¨","è¼ªéƒ­ã€ç· ã¾ã‚‹","å‹ã¦ã‚‹åˆˆã‚Šä¸Šã’"];
    let pool = basePool;
    if(/ãƒ•ã‚§ãƒ¼ãƒ‰|è–„æ¯›|ç”Ÿãˆéš›/.test(ctx.p) || /SANDGATE|ç¦äº•/.test(ctx.b)) pool = pool.concat(fadePool);
    const pick = pool[Math.floor(Math.random()*pool.length)];
    const lim = Math.max(4, parseInt(maxChars||12,10));
    let out = pick;
    if(out.length>lim) out = out.slice(0, lim-1) + "â€¦";
    return out;
  }

  const selected = new Set(PATTERNS.map(p=>p.id));
  function renderChips(){
    chipsWrap.innerHTML="";
    PATTERNS.forEach(p=>{
      const c=document.createElement("div");
      c.className="chip active"; c.textContent=p.id; c.dataset.id=p.id;
      c.addEventListener("click", ()=>{
        if(selected.has(p.id)){ selected.delete(p.id); c.classList.remove("active"); }
        else { selected.add(p.id); c.classList.add("active"); }
      });
      chipsWrap.appendChild(c);
    });
  }
  renderChips();

  function makeOne(p){
    const ctx = { t: target.value, p: painSel.value, b: brand.value, k: (function(){const c=CTA[cta.value]||["ä»Šã™ãè¡Œå‹•"];return c[Math.floor(Math.random()*c.length)];})() };
    let txt = p.text(ctx);
    const T = TONE[tone.value]; if(T) txt = T(txt);
    txt = injectKeywords(txt, (keywords.value || '').split(',').map(s=>s.trim()).filter(Boolean));
    txt = attachURL(txt);
    txt = attachTags(txt);
    const lim = parseInt(lengthSel.value,10); txt = limitLength(txt, lim);
    const thumb = makeThumb(p.id, ctx, parseInt(thumbLenSel.value,10));
    return { id:p.id, text:txt, thumb };
  }

  function renderCards(items){
    results.innerHTML="";
    items.forEach((it, idx)=>{
      const card=document.createElement("div"); card.className="card";
      const meta=document.createElement("div"); meta.className="meta";
      meta.innerHTML = `<span>${idx+1}</span><span>ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š${it.id}</span><span class="thumb">ã‚µãƒ ãƒå€™è£œï¼š<strong>${it.thumb}</strong></span>`;
      const p=document.createElement("p"); p.textContent=it.text;
      const line=document.createElement("div"); line.style.display="flex"; line.style.gap="8px"; line.style.marginTop="8px"; line.style.flexWrap="wrap";
      const b1=document.createElement("button"); b1.className="copy"; b1.textContent="æœ¬æ–‡ã‚’ã‚³ãƒ”ãƒ¼";
      const b2=document.createElement("button"); b2.className="copy"; b2.textContent="ã‚µãƒ ãƒã‚’ã‚³ãƒ”ãƒ¼";
      b1.addEventListener("click", async ()=>{ await navigator.clipboard.writeText(it.text); b1.textContent="âœ“ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"; setTimeout(()=>b1.textContent="æœ¬æ–‡ã‚’ã‚³ãƒ”ãƒ¼",1200); });
      b2.addEventListener("click", async ()=>{ await navigator.clipboard.writeText(it.thumb); b2.textContent="âœ“ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"; setTimeout(()=>b2.textContent="ã‚µãƒ ãƒã‚’ã‚³ãƒ”ãƒ¼",1200); });
      line.appendChild(b1); line.appendChild(b2);
      card.appendChild(meta); card.appendChild(p); card.appendChild(line);
      results.appendChild(card);
    });
  }

  async function generateWithGPT(payload){
    const endpoint = gptEndpoint.value.trim();
    if(!endpoint) throw new Error('GPTã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæœªè¨­å®š');
    const r = await fetch(endpoint, {
      method: 'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify(payload),
    });
    if(!r.ok) throw new Error('APIã‚¨ãƒ©ãƒ¼: ' + r.status);
    return await r.json(); // { items: [ { body, thumb }, ... ] }
  }

  async function generate(){
    const pats = PATTERNS.filter(p=>selected.has(p.id));
    if(!pats.length){ alert("å°‘ãªãã¨ã‚‚1ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚"); return; }

    const payload = {
      target: target.value,
      pain: painSel.value,
      tone: tone.value,
      cta: cta.value,
      brand: brand.value,
      bookUrl: bookUrl.value.trim() || null,
      fixedTags: parseFixedTags(),
      extraTags: (extraTags?.value || '').split(',').map(s=>s.trim()).filter(Boolean),
      lengthLimit: parseInt(lengthSel.value,10) || 0,
      count: 10
    };

    try {
      if(useGpt.checked){
        const { items } = await generateWithGPT(payload);
        const out = (items || []).map((it, i)=> ({
          id: 'GPT-'+(i+1),
          text: it.body,
          thumb: it.thumb || 'æ¸…æ½”æ„Ÿã€æ­£ç¾©'
        }));
        if(out.length){ renderCards(out); return; }
      }
    } catch (e){
      console.warn('GPTç”Ÿæˆã«å¤±æ•— â†’ ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆã¸ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯', e);
      alert('GPTç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆã§ç¶šè¡Œã—ã¾ã™ã€‚');
    }

    let out=[]; while(out.length<10){ out.push(makeOne(pats[Math.floor(Math.random()*pats.length)])); }
    renderCards(out);
  }

  function init(){
    loadPersisted();
    btnGen.addEventListener("click", generate);
    btnShuffle.addEventListener("click", generate);
    btnClear.addEventListener("click", ()=>{ results.innerHTML=""; });
    btnCopyAll.addEventListener("click", async ()=>{
      const texts=[...results.querySelectorAll(".card p")].map(p=>p.textContent.trim()).filter(Boolean);
      if(!texts.length) return;
      await navigator.clipboard.writeText(texts.join("\n\n"));
      btnCopyAll.textContent="âœ“ å…¨éƒ¨ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"; setTimeout(()=>btnCopyAll.textContent="å…¨éƒ¨ã‚³ãƒ”ãƒ¼",1500);
    });
    // åˆå›ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§10æœ¬ç”Ÿæˆ
    generate();
  }

  window.addEventListener('DOMContentLoaded', init);
})();</script>
</body>
</html>
