<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SANDGATE GPT Hooks｜管理ページ</title>
<meta name="color-scheme" content="light only" />

<!-- ====== Brand Theme (SANDGATE ロゴ基調) ====== -->
<style>
  :root{
    --bg:#f5efe3;          /* 生成AIロゴの台紙っぽいベージュ */
    --ink:#3b2b23;         /* ダークブラウン（本文）       */
    --muted:#6f5a4b;       /* 補助テキスト                 */
    --line:#e7dfd0;        /* 罫線                         */
    --accent:#b08b46;      /* ゴールド系アクセント         */
    --accent-ink:#2f241b;  /* 濃いブラウン(ボタン文字)     */

    --radius:16px;
    --shadow:0 4px 20px rgba(47,36,27,.08);
    --shadow-deep:0 10px 30px rgba(47,36,27,.12);
  }
  html,body{
    background:var(--bg);
    color:var(--ink);
    font-family: ui-sans-serif, system-ui, -apple-system, "Helvetica Neue",
                 "Segoe UI", "Hiragino Kaku Gothic ProN","Yu Gothic", Meiryo, sans-serif;
    line-height:1.6;
  }
  .wrap{max-width:1100px;margin:auto;padding:24px;}
  header{
    display:flex;gap:16px;align-items:center;margin-bottom:20px;
    border-bottom:1px solid var(--line);padding-bottom:16px;
  }
  .logo{
    width:54px;height:54px;border-radius:50%;
    background:radial-gradient(120% 120% at 30% 30%, #c7a86a 0, #a5823e 35%, #7b5c2e 60%, #3b2b23 100%);
    display:grid;place-items:center;color:#fff;font-weight:800;letter-spacing:1px;
    box-shadow:var(--shadow);
  }
  h1{font-size:22px;margin:0;}
  .sub{color:var(--muted);font-size:13px;margin-top:2px;}

  /* ====== Panel / Inputs ====== */
  .panel{
    background:#fff;border:1px solid var(--line);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:18px;margin-bottom:18px;
  }
  .grid{
    display:grid;gap:14px;
    grid-template-columns:repeat(12,1fr);
  }
  .col-6{grid-column:span 6;}
  .col-4{grid-column:span 4;}
  .col-8{grid-column:span 8;}
  .col-12{grid-column:span 12;}
  @media (max-width:900px){
    .col-6,.col-4,.col-8{grid-column:span 12;}
  }
  label{font-weight:600;font-size:13px;display:block;margin-bottom:6px;}
  input[type="text"], input[type="url"], input[type="number"], textarea, select{
    width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;
    background:#fff;color:var(--ink);outline:none;transition:.2s;
  }
  textarea{min-height:78px;resize:vertical;}
  input:focus,textarea:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(176,139,70,.15);}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .pill{
    padding:8px 12px;border:1px solid var(--line);border-radius:999px;font-size:13px;color:var(--muted);
    background:#fff;cursor:pointer;user-select:none;
  }
  .pill.active{border-color:var(--accent);color:var(--accent-ink);background:linear-gradient(#fff,#fff8ef);}
  .hint{font-size:12px;color:var(--muted);margin-top:4px}

  /* ====== Buttons ====== */
  .btn{
    appearance:none;border:0;outline:0;border-radius:12px;padding:10px 14px;
    background:linear-gradient(180deg,#d9bf84,#b18a45 60%,#9e793a);
    color:#fff;font-weight:700;letter-spacing:.2px;cursor:pointer;box-shadow:var(--shadow-deep);
    transition:transform .08s ease, filter .2s ease;
  }
  .btn:active{transform:translateY(1px)}
  .btn.secondary{
    background:#fff;color:var(--accent-ink);border:1px solid var(--line);box-shadow:var(--shadow);
  }
  .btn.ghost{background:transparent;border:1px dashed var(--line);color:var(--muted)}
  .btn-row{display:flex;gap:10px;flex-wrap:wrap}

  /* ====== Result Cards ====== */
  .cards{display:grid;gap:12px;grid-template-columns:repeat(12,1fr);}
  .card{
    grid-column:span 6;background:#fff;border:1px solid var(--line);
    border-radius:16px;padding:14px;box-shadow:var(--shadow);
    display:flex;flex-direction:column;gap:8px;
  }
  .card h3{font-size:16px;margin:0;color:var(--accent-ink)}
  .card p{margin:0;white-space:pre-wrap}
  .card .tools{display:flex;gap:8px;margin-top:6px}
  @media (max-width:900px){ .card{grid-column:span 12;} }

  /* ====== Footer ====== */
  footer{margin:28px 0;color:var(--muted);font-size:12px;text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">SG</div>
      <div>
        <h1>SANDGATE フック生成 管理ページ</h1>
        <div class="sub">福井市メンズ美容室｜フェード特化｜スタッフ用ジェネレーター</div>
      </div>
    </header>

    <!-- ========== 設定パネル ========== -->
    <section class="panel">
      <div class="grid">
        <div class="col-6">
          <label>ターゲット</label>
          <input id="target" type="text" placeholder="例：20代社会人／30代営業職／受験生 など">
        </div>
        <div class="col-6">
          <label>悩み / 制約</label>
          <input id="pain" type="text" placeholder="例：薄毛・生え際／直毛でボリュームが出ない／校則・会社規定 など">
        </div>

        <div class="col-4">
          <label>トーン</label>
          <select id="tone">
            <option>共感</option>
            <option>専門的</option>
            <option>勢い</option>
            <option>上品</option>
            <option>ユーモア</option>
          </select>
        </div>
        <div class="col-4">
          <label>CTA（行動）</label>
          <select id="cta">
            <option>予約する</option>
            <option>フォローする</option>
            <option>相談する</option>
            <option>保存する</option>
            <option>共有する</option>
          </select>
        </div>
        <div class="col-4">
          <label>予約URL（任意）</label>
          <input id="bookUrl" type="url" placeholder="https://...">
        </div>

        <div class="col-6">
          <label>ブランド（店名・地域）</label>
          <input id="brand" type="text" value="福井市・SANDGATE サンドゲート">
          <div class="hint">投稿文に自然に挿入されます。自由に編集可。</div>
        </div>

        <div class="col-3">
          <label>生成件数</label>
          <input id="count" type="number" min="1" max="20" value="10">
        </div>
        <div class="col-3">
          <label>本文 文字数上限（0=指定なし）</label>
          <input id="lengthLimit" type="number" min="0" max="180" value="100">
        </div>

        <div class="col-12">
          <label>固定ハッシュタグ（常に付与）</label>
          <input id="fixedTags" type="text"
                 value="#福井メンズ美容室 #SANDGATE #サンドゲート">
          <div class="hint">半角スペース区切り。例：#福井メンズ美容室 #SANDGATE #サンドゲート</div>
        </div>

        <div class="col-12">
          <label>追加ハッシュタグ（任意／前回値を自動復元）</label>
          <input id="extraTags" type="text"
                 placeholder="#フェード #スキンフェード #福井市 #メンズカット #フェードスタイル">
          <div class="hint">半角スペース区切り。例：#フェード #スキンフェード #福井市 #メンズカット #フェードスタイル</div>
        </div>

        <div class="col-12 btn-row">
          <button class="btn" id="btnGen">GPTで生成</button>
          <button class="btn secondary" id="btnSave">現在の設定を保存</button>
          <button class="btn ghost" id="btnClear">結果クリア</button>
          <span class="hint" id="status"></span>
        </div>
      </div>
    </section>

    <!-- ========== 結果 ========== -->
    <section class="panel">
      <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:6px">
        <h2 style="margin:0;font-size:18px">生成結果</h2>
        <div class="btn-row">
          <button class="btn secondary" id="btnCopyAll">すべてコピー（本文）</button>
          <button class="btn secondary" id="btnExport">CSVダウンロード</button>
        </div>
      </div>
      <div id="cards" class="cards"></div>
    </section>

    <footer>© SANDGATE. Built with GPT-4o-mini.</footer>
  </div>

<script>
/* ====== 設定 ====== */
const API_ENDPOINT = "https://sandgate-gpt-api.vercel.app/api/generate";
const LS_KEY = "sandgate_hooks_config_v1";

/* ====== ユーティリティ ====== */
const $ = (s)=>document.querySelector(s);
const statusEl = $("#status");

function toast(msg){
  statusEl.textContent = msg;
  clearTimeout(toast._t);
  toast._t = setTimeout(()=>statusEl.textContent="", 4000);
}
function getForm(){
  return {
    target: $("#target").value.trim(),
    pain: $("#pain").value.trim(),
    tone: $("#tone").value,
    cta: $("#cta").value,
    brand: $("#brand").value.trim(),
    bookUrl: $("#bookUrl").value.trim(),
    fixedTags: $("#fixedTags").value.trim().split(/\s+/).filter(Boolean),
    extraTags: $("#extraTags").value.trim().split(/\s+/).filter(Boolean),
    count: Math.max(1, Math.min(20, parseInt($("#count").value || "10", 10))),
    lengthLimit: Math.max(0, Math.min(200, parseInt($("#lengthLimit").value || "0", 10))),
  };
}
function setForm(cfg){
  $("#target").value = cfg.target ?? "";
  $("#pain").value = cfg.pain ?? "";
  $("#tone").value = cfg.tone ?? "共感";
  $("#cta").value = cfg.cta ?? "予約する";
  $("#brand").value = cfg.brand ?? "福井市・SANDGATE サンドゲート";
  $("#bookUrl").value = cfg.bookUrl ?? "";
  $("#fixedTags").value = (cfg.fixedTags ?? ["#福井メンズ美容室","#SANDGATE","#サンドゲート"]).join(" ");
  $("#extraTags").value = (cfg.extraTags ?? []).join(" ");
  $("#count").value = cfg.count ?? 10;
  $("#lengthLimit").value = cfg.lengthLimit ?? 100;
}
function saveConfig(){
  const cfg = getForm();
  localStorage.setItem(LS_KEY, JSON.stringify(cfg));
  toast("設定を保存しました");
}
function loadConfig(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(raw){ setForm(JSON.parse(raw)); toast("前回の設定を復元しました"); }
    else { setForm({}); }
  }catch{ setForm({}); }
}

/* ====== コピー/CSV ====== */
function copy(text){
  navigator.clipboard.writeText(text).then(()=>toast("コピーしました"));
}
function exportCSV(items){
  const rows = [["thumb","body"]];
  items.forEach(i=>rows.push([i.thumb.replace(/"/g,'""'), i.body.replace(/"/g,'""')]));
  const csv = rows.map(r=>`"${r[0]}","${r[1]}"`).join("\n");
  const blob = new Blob([csv],{type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "sandgate_hooks.csv"; a.click();
  URL.revokeObjectURL(url);
}

/* ====== レンダリング ====== */
function render(items){
  const wrap = $("#cards");
  wrap.innerHTML = "";
  items.forEach((it,idx)=>{
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <h3>${escapeHtml(it.thumb || `サムネ ${idx+1}`)}</h3>
      <p>${escapeHtml(it.body || "")}</p>
      <div class="tools">
        <button class="btn secondary" data-act="copyBody">本文コピー</button>
        <button class="btn secondary" data-act="copyThumb">サムネ文言コピー</button>
      </div>
    `;
    card.querySelector('[data-act="copyBody"]').onclick = ()=>copy(it.body || "");
    card.querySelector('[data-act="copyThumb"]').onclick = ()=>copy(it.thumb || "");
    wrap.appendChild(card);
  });
}
function escapeHtml(s){return s.replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]))}

/* ====== GPT 生成 ====== */
async function generate(){
  const payload = getForm();
  $("#btnGen").disabled = true;
  $("#btnGen").textContent = "生成中…";
  toast("GPTに送信中…");

  // 本文に固定＋追加タグを付けるのはフロント側で最終合成してもOK
  const res = await fetch(API_ENDPOINT, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  }).catch(e=>({ ok:false, statusText:String(e) }));

  $("#btnGen").disabled = false;
  $("#btnGen").textContent = "GPTで生成";

  if(!res || !res.ok){
    toast("エラー: " + (res?.statusText || "ネットワーク"));
    return;
  }
  const data = await res.json();

  // 最終タグ付与 & 予約URL挿入
  const fixed = payload.fixedTags.join(" ");
  const extra = payload.extraTags.join(" ");
  const tagLine = [fixed, extra].filter(Boolean).join(" ");
  const items = (data.items || []).map(raw=>{
    const body = (raw.body || "").trim()
      + (payload.bookUrl ? `\n→ ${payload.bookUrl}` : "")
      + (tagLine ? `\n${tagLine}` : "");
    return { body, thumb: raw.thumb || "清潔感、正義" };
  });

  render(items);
  // 最新結果を保存（次回CSV/コピーしやすいように）
  window._lastItems = items;
  toast(`生成完了：${items.length}件`);
}

/* ====== イベント ====== */
$("#btnGen").addEventListener("click", generate);
$("#btnSave").addEventListener("click", saveConfig);
$("#btnClear").addEventListener("click", ()=>{ $("#cards").innerHTML=""; toast("結果をクリアしました"); });
$("#btnCopyAll").addEventListener("click", ()=>{
  const items = window._lastItems || [];
  if(!items.length) return toast("コピー対象がありません");
  copy(items.map(i=>`${i.thumb}\n${i.body}`).join("\n\n---\n\n"));
});
$("#btnExport").addEventListener("click", ()=>{
  const items = window._lastItems || [];
  if(!items.length) return toast("エクスポート対象がありません");
  exportCSV(items);
});

/* 初期化 */
loadConfig();
</script>
</body>
</html>
