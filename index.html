<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<!-- ğŸ“µ ãƒ¢ãƒã‚¤ãƒ«æ‹¡å¤§ç¦æ­¢ -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>SAND GATEã€€SNSãƒ•ãƒƒã‚¯ç”Ÿæˆ</title>
<meta name="color-scheme" content="light only" />
<style>
  :root{
    --bg:#f5efe3; --ink:#3b2b23; --muted:#6f5a4b; --line:#e7dfd0;
    --accent:#b08b46; --accent-ink:#2f241b;
    --radius:14px; --shadow:0 4px 18px rgba(47,36,27,.08);
    --shadow-deep:0 10px 28px rgba(47,36,27,.12);
    --control-h:52px;       /* â¬…ï¸ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®é«˜ã•ã‚’å¤§ãã */
    --control-fz:16px;      /* â¬…ï¸ æ–‡å­—ã‚µã‚¤ã‚ºã‚‚æ‹¡å¤§        */
  }
  *,*::before,*::after{box-sizing:border-box}
  html,body{background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;line-height:1.6}
  .wrap{max-width:980px;margin:auto;padding:20px}
  header{display:flex;gap:14px;align-items:center;margin-bottom:16px}
  .brand-logo{
    width:56px;height:56px;border-radius:12px;object-fit:cover;background:#e8dcc7;border:1px solid var(--line);box-shadow:var(--shadow)
  }
  /* ãƒ­ã‚´ãŒç„¡ã„ã¨ãã®ä»£æ›¿ */
  .logo-fallback{
    width:56px;height:56px;border-radius:12px;display:grid;place-items:center;
    background:radial-gradient(120% 120% at 30% 30%, #c7a86a 0, #a5823e 35%, #7b5c2e 60%, #3b2b23 100%);
    color:#fff;font-weight:800;letter-spacing:.5px
  }
  h1{font-size:20px;margin:0}
  .sub{color:var(--muted);font-size:12px;margin-top:2px}

  .panel{background:#fff;border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin-bottom:14px}
  .grid{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
  .col-3{grid-column:span 3}.col-4{grid-column:span 4}.col-6{grid-column:span 6}.col-8{grid-column:span 8}.col-9{grid-column:span 9}.col-12{grid-column:span 12}
  @media (max-width:900px){ .col-3,.col-4,.col-6,.col-8,.col-9{grid-column:span 12} }

  label{font-weight:600;font-size:13px;display:block;margin-bottom:6px}
  input[type="text"],input[type="url"],input[type="number"],textarea,select{
    width:100%;max-width:100%;
    height:var(--control-h);
    padding:12px 14px;
    font-size:var(--control-fz);
    border:1px solid var(--line);border-radius:12px;background:#fff;color:var(--ink);outline:0;transition:.2s;
  }
  /* ã‚»ãƒ¬ã‚¯ãƒˆã®è¦‹ãŸç›®å°‘ã—å¤§ãã */
  select{appearance:none;background-image:linear-gradient(45deg, transparent 50%, var(--muted) 50%),linear-gradient(135deg, var(--muted) 50%, transparent 50%);background-position:calc(100% - 18px) calc(50% - 4px), calc(100% - 13px) calc(50% + 4px);background-size:6px 6px, 6px 6px;background-repeat:no-repeat;padding-right:36px}
  textarea{min-height:calc(var(--control-h)*2);resize:vertical}
  input:focus,textarea:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(176,139,70,.15)}
  .hint{font-size:12px;color:var(--muted);margin-top:4px}

  .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;background:linear-gradient(180deg,#d9bf84,#b18a45 60%,#9e793a);color:#fff;font-weight:700;cursor:pointer;box-shadow:var(--shadow-deep);transition:transform .08s ease}
  .btn:active{transform:translateY(1px)}
  .btn.secondary{background:#fff;color:var(--accent-ink);border:1px solid var(--line);box-shadow:var(--shadow)}
  .btn.ghost{background:transparent;border:1px dashed var(--line);color:var(--muted)}
  .btn-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  #status{font-size:12px;color:var(--muted)}

  .cards{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
  .card{grid-column:span 6;background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px}
  @media (max-width:900px){ .card{grid-column:span 12} }
  .card h3{font-size:16px;margin:0;color:var(--accent-ink)}
  .card p{margin:0;white-space:pre-wrap}
  .tools{display:flex;gap:8px;margin-top:6px}

  .err{background:#fff2f0;border:1px solid #ffd9d2;color:#7a2a1f;border-radius:12px;padding:10px 12px;margin-top:8px;display:none}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <!-- ãƒ­ã‚´ï¼šlogo.png ãŒã‚ã‚Œã° imgã€ç„¡ã‘ã‚Œã° fallback -->
    <img src="logo.png" alt="SAND GATE" class="brand-logo" onerror="this.style.display='none';document.getElementById('logoFallback').style.display='grid'">
    <div id="logoFallback" class="logo-fallback" style="display:none">SG</div>
    <div>
      <h1>SAND GATEã€€SNSãƒ•ãƒƒã‚¯ç”Ÿæˆ</h1>
      <div class="sub">SAND GATEã‚¹ã‚¿ãƒƒãƒ•å°‚ç”¨ã®ãƒ•ãƒƒã‚¯ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã™</div>
    </div>
  </header>

  <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
  <section class="panel">
    <div class="grid">
      <!-- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆé¸æŠï¼‹è‡ªç”±å…¥åŠ›ï¼‰ -->
      <div class="col-6">
        <label>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ</label>
        <div class="grid">
          <div class="col-6">
            <select id="targetSel">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option>å¤§å­¦ç”Ÿ</option><option>é«˜æ ¡ç”Ÿ</option><option>ç¤¾ä¼šäºº 20ä»£</option>
              <option>ç¤¾ä¼šäºº 30ä»£</option><option>å–¶æ¥­è·</option><option>æ¥å®¢æ¥­</option>
              <option>çµŒå–¶è€…</option><option>å°±æ´»ç”Ÿ</option><option value="__custom">ãã®ä»–ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</option>
            </select>
          </div>
          <div class="col-6"><input id="targetFree" type="text" placeholder="è‡ªç”±å…¥åŠ›ï¼ˆä¾‹ï¼š30ä»£ãƒ“ã‚¸ãƒã‚¹ãƒãƒ³ï¼‰" style="display:none"></div>
        </div>
      </div>

      <!-- æ‚©ã¿/åˆ¶ç´„ï¼ˆé¸æŠï¼‹è‡ªç”±å…¥åŠ›ï¼‰ -->
      <div class="col-6">
        <label>æ‚©ã¿ / åˆ¶ç´„</label>
        <div class="grid">
          <div class="col-6">
            <select id="painSel">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option>ç›´æ¯›ã§ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒå‡ºãªã„</option>
              <option>è–„æ¯›ãƒ»ç”Ÿãˆéš›</option>
              <option>ãã›æ¯›ãƒ»ã†ã­ã‚Š</option>
              <option>æ ¡å‰‡ãƒ»ä¼šç¤¾è¦å®š</option>
              <option>æœã®ã‚»ãƒƒãƒˆãŒè‹¦æ‰‹</option>
              <option>é ­çš®ã®ãƒ™ã‚¿ã¤ã</option>
              <option value="__custom">ãã®ä»–ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</option>
            </select>
          </div>
          <div class="col-6"><input id="painFree" type="text" placeholder="è‡ªç”±å…¥åŠ›ï¼ˆä¾‹ï¼šé¢æ¥ã§å¥½å°è±¡ã«è¦‹ã›ãŸã„ï¼‰" style="display:none"></div>
        </div>
      </div>

      <div class="col-4">
        <label>ãƒˆãƒ¼ãƒ³</label>
        <select id="tone">
          <option>å…±æ„Ÿ</option><option>å°‚é–€çš„</option><option>å‹¢ã„</option><option>ä¸Šå“</option><option>ãƒ¦ãƒ¼ãƒ¢ã‚¢</option>
        </select>
      </div>
      <div class="col-4">
        <label>CTAï¼ˆè¡Œå‹•ï¼‰</label>
        <select id="cta">
          <option>äºˆç´„ã™ã‚‹</option><option>ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹</option><option>ç›¸è«‡ã™ã‚‹</option><option>ä¿å­˜ã™ã‚‹</option><option>å…±æœ‰ã™ã‚‹</option>
        </select>
      </div>
      <div class="col-4">
        <label>äºˆç´„URLï¼ˆä»»æ„ï¼‰</label>
        <input id="bookUrl" type="url" placeholder="https://...">
      </div>

      <div class="col-9">
        <label>ãƒ–ãƒ©ãƒ³ãƒ‰ï¼ˆåº—åãƒ»åœ°åŸŸï¼‰</label>
        <input id="brand" type="text" value="ç¦äº•å¸‚ãƒ»SAND GATE">
        <div class="hint">æŠ•ç¨¿æ–‡ã«è‡ªç„¶ã«æŒ¿å…¥ã•ã‚Œã¾ã™ã€‚è‡ªç”±ã«ç·¨é›†å¯ã€‚</div>
      </div>
      <div class="col-3">
        <label>ç”Ÿæˆä»¶æ•° / æœ¬æ–‡ä¸Šé™</label>
        <div class="grid">
          <!-- ç”Ÿæˆä»¶æ•°ï¼š1ã€œ4 ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ -->
          <div class="col-6">
            <select id="count">
              <option>1</option><option selected>2</option><option>3</option><option>4</option>
            </select>
          </div>
          <div class="col-6"><input id="lengthLimit" type="number" min="0" max="200" value="100"></div>
        </div>
      </div>

      <div class="col-12">
        <label>å›ºå®šãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆå¸¸ã«ä»˜ä¸ï¼‰</label>
        <!-- 4è¡Œè¡¨ç¤º -->
        <textarea id="fixedTags" rows="4">#ç¦äº•ãƒ¡ãƒ³ã‚ºç¾å®¹å®¤ #SANDGATE #ã‚µãƒ³ãƒ‰ã‚²ãƒ¼ãƒˆ</textarea>
        <div class="hint">åŠè§’ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã€‚ä¾‹ï¼š#ç¦äº•ãƒ¡ãƒ³ã‚ºç¾å®¹å®¤ #SANDGATE #ã‚µãƒ³ãƒ‰ã‚²ãƒ¼ãƒˆ</div>
      </div>

      <div class="col-12">
        <label>è¿½åŠ ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆä»»æ„ï¼å‰å›å€¤ã‚’è‡ªå‹•å¾©å…ƒï¼‰</label>
        <textarea id="extraTags" rows="4" placeholder="#ãƒ•ã‚§ãƒ¼ãƒ‰ #ã‚¹ã‚­ãƒ³ãƒ•ã‚§ãƒ¼ãƒ‰ #ç¦äº•å¸‚ #ãƒ¡ãƒ³ã‚ºã‚«ãƒƒãƒˆ #ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«"></textarea>
      </div>

      <div class="col-12 btn-row">
        <button class="btn" id="btnGen">GPTã§ç”Ÿæˆ</button>
        <button class="btn secondary" id="btnSave">ç¾åœ¨ã®è¨­å®šã‚’ä¿å­˜</button>
        <button class="btn ghost" id="btnClear">çµæœã‚¯ãƒªã‚¢</button>
        <span id="status"></span>
      </div>

      <div class="col-12 err" id="errorBox"></div>
    </div>
  </section>

  <!-- çµæœ -->
  <section class="panel">
    <div class="btn-row" style="justify-content:space-between">
      <h2 style="margin:0;font-size:18px">ç”Ÿæˆçµæœ</h2>
      <div class="btn-row">
        <button class="btn secondary" id="btnCopyAll">ã™ã¹ã¦ã‚³ãƒ”ãƒ¼ï¼ˆæœ¬æ–‡ï¼‰</button>
        <button class="btn secondary" id="btnExport">CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
      </div>
    </div>
    <div id="cards" class="cards"></div>
  </section>

  <footer class="sub" style="text-align:center;margin:20px 0">Â© SAND GATE. Built with GPT-4o-mini.</footer>
</div>

<script>
/* ===== è¨­å®š ===== */
const API_ENDPOINT = "https://sandgate-gpt-api.vercel.app/api/generate";
const LS_KEY = "sandgate_hooks_config_v2";

/* ===== Util ===== */
const $ = s => document.querySelector(s);
const statusEl = $("#status"); const errBox = $("#errorBox");
function toast(m){ statusEl.textContent=m; clearTimeout(toast._t); toast._t=setTimeout(()=>statusEl.textContent="",4000); }
function showErr(m){ errBox.textContent=m; errBox.style.display="block"; }
function hideErr(){ errBox.style.display="none"; }

/* ===== ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ â†” è‡ªç”±å…¥åŠ›ã®åˆ‡æ›¿ ===== */
function comboValue(sel, free){ return sel.value==="__custom" ? free.value.trim() : (sel.value||""); }
function onComboChange(selId, freeId){
  const sel = $(selId), free = $(freeId);
  const isFree = sel.value==="__custom";
  free.style.display = isFree ? "block" : "none";
  if(!isFree) free.value = "";
}
$("#targetSel").addEventListener("change", ()=>onComboChange("#targetSel","#targetFree"));
$("#painSel").addEventListener("change", ()=>onComboChange("#painSel","#painFree"));

/* ===== ãƒ•ã‚©ãƒ¼ãƒ IO ===== */
function splitTags(text){
  return String(text||"").split(/\s+/).filter(Boolean);
}
function getForm(){
  return {
    target: comboValue($("#targetSel"), $("#targetFree")),
    pain: comboValue($("#painSel"), $("#painFree")),
    tone: $("#tone").value, cta: $("#cta").value,
    brand: $("#brand").value.trim(),
    bookUrl: $("#bookUrl").value.trim(),
    fixedTags: splitTags($("#fixedTags").value),
    extraTags: splitTags($("#extraTags").value),
    count: Math.max(1, Math.min(4, parseInt($("#count").value||"2",10))),  // 1ã€œ4ã«åˆ¶é™
    lengthLimit: Math.max(0, Math.min(200, parseInt($("#lengthLimit").value||"0",10)))
  };
}
function setForm(cfg){
  const setCombo = (sel, free, val) => {
    const found = [...sel.options].some(o=>o.value===val||o.text===val);
    if(found){ sel.value = val; free.style.display="none"; free.value=""; }
    else if(val){ sel.value="__custom"; free.style.display="block"; free.value=val; }
    else { sel.value=""; free.style.display="none"; free.value=""; }
  };
  setCombo($("#targetSel"), $("#targetFree"), cfg.target||"");
  setCombo($("#painSel"), $("#painFree"), cfg.pain||"");

  $("#tone").value = cfg.tone ?? "å…±æ„Ÿ";
  $("#cta").value = cfg.cta ?? "äºˆç´„ã™ã‚‹";
  $("#brand").value = cfg.brand ?? "ç¦äº•å¸‚ãƒ»SAND GATE";
  $("#bookUrl").value = cfg.bookUrl ?? "";
  $("#fixedTags").value = (cfg.fixedTags ?? ["#ç¦äº•ãƒ¡ãƒ³ã‚ºç¾å®¹å®¤","#SANDGATE","#ã‚µãƒ³ãƒ‰ã‚²ãƒ¼ãƒˆ"]).join(" ");
  $("#extraTags").value = (cfg.extraTags ?? []).join(" ");
  $("#count").value = String(Math.max(1, Math.min(4, Number(cfg.count ?? 2))));
  $("#lengthLimit").value = cfg.lengthLimit ?? 100;
}
function saveConfig(){ localStorage.setItem(LS_KEY, JSON.stringify(getForm())); toast("è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ"); }
function loadConfig(){ try{ const raw=localStorage.getItem(LS_KEY); if(raw) setForm(JSON.parse(raw)); else setForm({}); } catch{ setForm({}); } }

/* ===== è¡¨ç¤ºç³» ===== */
function escapeHtml(s){return (s||"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]))}
function render(items){
  const wrap = $("#cards"); wrap.innerHTML="";
  items.forEach((it,idx)=>{
    const el = document.createElement("div");
    el.className="card";
    el.innerHTML = `<h3>${escapeHtml(it.thumb || `ã‚µãƒ ãƒ ${idx+1}`)}</h3>
                    <p>${escapeHtml(it.body||"")}</p>
                    <div class="tools">
                      <button class="btn secondary" data-b="b">æœ¬æ–‡ã‚³ãƒ”ãƒ¼</button>
                      <button class="btn secondary" data-b="t">ã‚µãƒ ãƒæ–‡è¨€ã‚³ãƒ”ãƒ¼</button>
                    </div>`;
    el.querySelector('[data-b="b"]').onclick=()=>navigator.clipboard.writeText(it.body||"").then(()=>toast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));
    el.querySelector('[data-b="t"]').onclick=()=>navigator.clipboard.writeText(it.thumb||"").then(()=>toast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));
    wrap.appendChild(el);
  });
}

/* ===== CSV ===== */
function exportCSV(items){
  const rows=[["thumb","body"], ...items.map(i=>[i.thumb?.replace(/"/g,'""')||"", i.body?.replace(/"/g,'""')||""])];
  const csv=rows.map(r=>`"${r[0]}","${r[1]}"`).join("\n");
  const url=URL.createObjectURL(new Blob([csv],{type:"text/csv;charset=utf-8"}));
  const a=document.createElement("a"); a.href=url; a.download="sandgate_hooks.csv"; a.click(); URL.revokeObjectURL(url);
}

/* ===== URL/ã‚¿ã‚°é‡è¤‡ã®å®‰å…¨å‡¦ç† ===== */
function appendOnce(base, addition){
  if(!addition) return base;
  return base.includes(addition) ? base : (base + (base.endsWith("\n")? "" : "\n") + addition);
}

/* ===== GPT å‘¼ã³å‡ºã— ===== */
async function generate(){
  hideErr();
  const payload=getForm();
  if(!payload.target){ showErr("ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’é¸ã¶ã‹å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"); return; }
  if(!payload.pain){ showErr("æ‚©ã¿/åˆ¶ç´„ã‚’é¸ã¶ã‹å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"); return; }

  $("#btnGen").disabled=true; $("#btnGen").textContent="ç”Ÿæˆä¸­â€¦"; toast("GPTã«é€ä¿¡ä¸­â€¦");
  try{
    const res=await fetch(API_ENDPOINT,{ method:"POST", headers:{ "Content-Type":"application/json" }, body:JSON.stringify(payload) });
    if(!res.ok){
      const text=await res.text(); showErr(`APIã‚¨ãƒ©ãƒ¼: ${res.status} ${res.statusText}\n${text}`); return;
    }
    const data=await res.json();

    const fixed=payload.fixedTags.join(" ");
    const extra=payload.extraTags.join(" ");
    const tagLine=[fixed,extra].filter(Boolean).join(" ");

    const items=(data.items||[]).slice(0, payload.count).map(x=>{
      let body=(x.body||"").trim();

      // äºˆç´„URLãŒæœ¬æ–‡å†…ã«æ—¢ã«å«ã¾ã‚Œã¦ã„ã‚Œã°è¿½è¨˜ã—ãªã„
      if(payload.bookUrl){
        try{
          const u = new URL(payload.bookUrl);
          const must = u.href.replace(/\/$/, "");
          const has = body.includes(must) || body.includes(u.hostname);
          if(!has) body = appendOnce(body, `â†’ ${must}`);
        }catch{ /* ç„¡åŠ¹URLãªã‚‰ä½•ã‚‚ã—ãªã„ */ }
      }

      // ã‚¿ã‚°è¡Œã‚‚é‡è¤‡ã—ãªã„ã‚ˆã†ã«ä¸€æ‹¬ã§æœ«å°¾ã¸
      if(tagLine) body = appendOnce(body, tagLine);

      return { body, thumb: x.thumb || "æ¸…æ½”æ„Ÿã€æ­£ç¾©" };
    });

    window._lastItems=items; render(items); toast(`ç”Ÿæˆå®Œäº†ï¼š${items.length}ä»¶`);
  }catch(e){
    showErr("é€šä¿¡ã‚¨ãƒ©ãƒ¼: "+String(e));
  }finally{
    $("#btnGen").disabled=false; $("#btnGen").textContent="GPTã§ç”Ÿæˆ";
  }
}

/* ===== ãƒœã‚¿ãƒ³ ===== */
$("#btnGen").addEventListener("click", generate);
$("#btnSave").addEventListener("click", saveConfig);
$("#btnClear").addEventListener("click", ()=>{ $("#cards").innerHTML=""; toast("çµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ"); });
$("#btnCopyAll").addEventListener("click", ()=>{
  const items=window._lastItems||[]; if(!items.length) return toast("ã‚³ãƒ”ãƒ¼å¯¾è±¡ãŒã‚ã‚Šã¾ã›ã‚“");
  navigator.clipboard.writeText(items.map(i=>`${i.thumb}\n${i.body}`).join("\n\n---\n\n")).then(()=>toast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));
});
$("#btnExport").addEventListener("click", ()=>{ const items=window._lastItems||[]; if(!items.length) return toast("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¯¾è±¡ãŒã‚ã‚Šã¾ã›ã‚“"); exportCSV(items); });

/* åˆæœŸåŒ– */
(function loadConfig(){
  try{ const raw=localStorage.getItem(LS_KEY); if(raw) setForm(JSON.parse(raw)); else setForm({}); } catch{ setForm({}); }
})();
</script>
</body>
</html>
